name: Test Python Setup

on:
  push:
    branches:
      - test-871-portablebinary

jobs:
  test-python-setup:
    runs-on: self-hosted
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Clear cache
      run: |
        sudo rm -rf "${{ runner.temp }}/*"
    # - name: Download Python artifact
    #   run: |
    #     wget https://github.com/priya-kinthali/python-versions/releases/download/3.12.3-10005803889/python-3.12.3-linux-22.04-x64.tar.gz -O ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz
    #     tar -xzf ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz -C ${{ runner.temp }}
    #     echo "export PATH=${{ runner.temp }}/python-3.12.3-linux-22.04-x64/bin:$PATH" >> $GITHUB_ENV

    # - name: Check Python version
    #   run: |
    #     source $GITHUB_ENV
    #     python --version

    # - name: Check Python version with sudo
    #   run: |
    #     source $GITHUB_ENV
    #     sudo python --version
    - name: Download Python artifact
      run: |
        wget https://github.com/priya-kinthali/python-versions/releases/download/3.12.3-10005803889/python-3.12.3-linux-22.04-x64.tar.gz -O ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz

    - name: List tar.gz contents
      run: |
        tar -tzf ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz

    - name: Extract Python artifact
      run: |
        tar -xzf ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz -C ${{ runner.temp }}

    - name: List directory contents
      run: |
        ls -l ${{ runner.temp }}
    - name: Print PATH
      run: |
        echo $PATH

    # - name: Create symbolic link
    #   run: |
    #     sudo ln -sf ${{ runner.temp }}/bin/python3.12 /usr/bin/python
    #     sudo ln -sf /usr/bin/python3 /usr/bin/python
    - name: Create symbolic link
      run: |
        PYTHON_PATH="${{ runner.temp }}/bin/python3.12"
        if [ ! -f "$PYTHON_PATH" ]; then
          echo "Python 3.12 binary not found."
          exit 1
        fi
        sudo ln -sf $PYTHON_PATH /usr/bin/python
        sudo $PYTHON_PATH --version
    - name: Check Python version
      run: python --version

    
    - name: Print environment variables without sudo
      run: printenv

    - name: Print environment variables with sudo
      run: sudo printenv

    - name: Check Python version with sudo and preserved environment
      run: sudo -E python --version
    # - name: Check Python version with sudo
    #   run: sudo python --version
    # - name: Download Python 3.12.3
    #   run: |
    #     wget https://github.com/priya-kinthali/python-versions/releases/download/3.12.3-10005803889/python-3.12.3-linux-22.04-x64.tar.gz -O ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz
    #     mkdir ${{ runner.temp }}/python-3.12.3-linux-22.04-x64
    #     tar -xzvf ${{ runner.temp }}/python-3.12.3-linux-22.04-x64.tar.gz -C ${{ runner.temp }}/python-3.12.3-linux-22.04-x64

    # - name: Run script
    #   run: |
    #     echo "run script"
    #     bash setup.sh
    #   working-directory: ${{ runner.temp }}/python-3.12.3-linux-22.04-x64

    # - name: Add Python to PATH
    #   run: echo "/opt/hostedtoolcache/Python/3.12.3/x64/" >> $GITHUB_PATH

    # - name: Check Python version
    #   run: python --version

    # - name: Check Python version with sudo
    #   run: sudo python --version

